(function(d){var b=window.AmazonUIPageJS||window.P,t=b._namespace||b.attributeErrors,a=t?t("InTransitActionsBuzzAssets",""):b;a.guardFatal?a.guardFatal(d)(a,window):a.execute(function(){d(a,window)})})(function(d,b,t){"use strict";d.register("in-transit-csm-metrics-utils",function(){var a,f;try{a=navigator.userAgent}catch(c){a=""}a&&(a=a.toLowerCase(),(a=a.match(/(chrome|firefox|safari|trident|ddge|opr|crios|fxios)/gi))&&0<a.length&&(-1<a.indexOf("safari")&&1<a.length?-1<a.indexOf("chrome")||-1<a.indexOf("crios")?
f="chrome":-1<a.indexOf("fxios")&&(f="firefox"):f=a[0]));var e=[],g=function(c){b.ue&&b.uex&&uex("ld",c,{wb:1});c=e.indexOf(c);-1<c&&e.splice(c,1)};b.addEventListener("beforeunload",function(c){for(;0<e.length;)g(e[0])});return{setScope:function(c){b.ue&&b.uet&&b.uet("tc",c);return c},setPreAjax:function(c){b.ue&&b.ues&&b.ues("t0",c,new Date)},setPostAjax:function(c){b.ue&&b.uet&&b.uet("be",c)},sendAjaxMetrics:function(c){b.ue&&b.uex&&b.uex("ld",c)},recordReftag:function(c,b){c.ajax({type:"POST",
url:"/gp/mobile/tag?"+b,success:function(b){console.log("record ref tag ajax call success: ",b)},error:function(b){console.log("ref tag ajax call error: ",b)}})},logFatal:function(c){if(b.ueLogError){var a=c.feature||"pt2-fatal-generic";b.ueLogError(c.error||{message:c.message||a},{logLevel:"FATAL",attribution:a})}},logError:function(c){if(b.ueLogError){var a=c.feature||"pt2-error-generic";b.ueLogError(c.error||{message:c.message||a},{logLevel:"ERROR",attribution:a})}},logWarn:function(a){if(b.ueLogError){var g=
a.feature||"pt2-warn-generic";b.ueLogError(a.error||{message:a.message||g},{logLevel:"WARN",attribution:g})}},incrementCount:function(a,g){b.ue&&b.ue.count&&(b.ue.count(a,(b.ue.count(a)||0)+1),g&&g.browser&&f&&b.ue.count(a+"-"+f,(b.ue.count(a+"-"+f)||0)+1))},startWidgetTimer:function(a){b.ue&&b.uet&&0>e.indexOf(a)&&(uet("bb",a,{wb:1}),e.push(a))},stopWidgetTimer:g}});"use strict";d.when("A").register("in-transit-url-utils",function(a){function b(a){return a.split("\x26").reduce(function(a,b){b=b.split("\x3d").map(function(a){return decodeURIComponent(a.replace(/\+/g,
" "))});a[b[0]]=b[1];return a},{})}var e=a.$;return{getQueryParameterFromUrl:function(a,c){a=-1<a.indexOf("?")?a.substr(a.indexOf("?")):"";-1<a.indexOf("#")&&(a=a.substring(0,a.indexOf("#")));a=b(a);return a[c]?a[c]:!1},addQueryParameterToUrl:function(a,b){var f=!1;-1<a.indexOf("#")&&(f=a.substring(a.indexOf("#")),a=a.substr(0,a.indexOf("#")));b=e.param(b);a=-1<a.indexOf("?")?a+("\x26"+b):a+("?"+b);return f?a+f:a}}});"use strict";d.when("A","in-transit-csm-metrics-utils","ready").register("in-transit-sign-in-again-or-do",
function(a,f){var e=-1!==b.location.host.indexOf("hp-shoppingportal")?"/portal/cstrac/progress-tracker/actions/is-authenticated":"/progress-tracker/package/actions/is-authenticated",g;return function(c,f,d,k,n){a.post(e,{params:{csrfToken:k.csrfToken},success:function(a){a.success&&a.value?n&&n():a.success?(a=c.$currentTarget,k.width=620>b.innerWidth?.75*b.innerWidth:600,k.name=d,k.dataStrategy="preload",g||(g=f.create(a,k)),g.update({header:k.header||""}).show()):console.log("service failed")},error:function(a){}})}});
"use strict";d.when("A","in-transit-csm-metrics-utils","a-tooltip","ready").register("in-transit-tooltip",function(a,b,e){function g(a){b.incrementCount(a+"-total");k&&(b.incrementCount(a+"-unique"),k=!1)}function c(a){u("body").addClass("in-transit-tooltip-style-override "+d.deviceType);u(".in-transit-tooltip-trigger."+a).attr("title","")}var u=a.$,d=a.state("page-state")||{},k=!0,n=function(b){a.declarative("a-tooltip","mouseenter",function(a){c(b);g(b)});a.declarative("a-tooltip","click",function(a){a.$event.preventDefault()})},
l=function(b){a.declarative("a-tooltip","click",function(a){c(b);a=u(".in-transit-tooltip-trigger."+b);a=e.get(a);a.isVisible()?a.hide():g(b)})};return function(a){"desktop"!==d.deviceType&&d.deviceType?l(a):n(a)}});"use strict";d.when("A","a-modal","a-button","jQuery","in-transit-url-utils","in-transit-csm-metrics-utils","in-transit-tooltip","ready").register("rescheduleDelivery",function(a,f,e,g,c,d,t){function k(){a.state.parse();m=a.state("page-state")||{};v=w();q=r+v;A=1==m.stringDebug;x=h("#reschedule-calendar-page-container").hasClass("r2w");
h(".in-transit-tooltip-trigger.reschedule-tooltip-trigger").length&&t("reschedule-tooltip-trigger");n();p()}function n(){var a=h(".reschedule-day.enabled"),c=h(".delivery-window"),d=h(".day-choice-button",".reschedule-day.enabled"),f=h(".window-choice-button",".delivery-window.enabled"),e=h(".reschedule-go-back"),q=h(".reschedule-month-label"),g=h(".calendar-inner-month-name");d.click(function(b){b=h(this).parent();if(!b.hasClass("selected")){a.removeClass("selected").attr("aria-checked","false");
b.addClass("selected").attr("aria-checked","true");var d=b.data("day-number"),d=h("#delivery-window-for_"+d),f=b.data("month-title");q.text()!==f&&q.text(f);g.show().filter(function(a){return this.getAttribute("data-for-month-title")===f}).hide();c.removeClass("selected").attr("aria-checked","false");x?d.addClass("visible").siblings().removeClass("visible"):d.find(".delivery-window").addClass("selected").attr("aria-checked","true");p()}});f.click(function(a){a=h(this).parent();a.hasClass("selected")||
(c.removeClass("selected").attr("aria-checked","false"),a.addClass("selected").attr("aria-checked","true"),p())});e.click(function(){b.history&&"function"===typeof b.history.back&&b.history.back()})}function l(){var a=h(".delivery-window.selected"),b={day:null,window:null,tokenId:null};if(1!==h(".reschedule-day.selected").length||1!==a.length)return b;b.day=a.first().text();b.window=a.first().text();b.tokenId=a.first().data("token");return b}function p(){var a=e("#reschedule-submit-button"),b=l();
b.tokenId&&null!==b.tokenId?a.enable():a.disable()}function w(){return"?"+h.param({orderId:m.orderId,shipmentId:m.shipmentId,packageIndex:m.packageIndex})+"\x26amzlMessageId\x3d"}var h=a.$,m=a.state("page-state")||{},r=-1!==b.location.host.indexOf("hp-shoppingportal")?"/portal/cstrac/progress-tracker":"/progress-tracker/package",y=r+"/actions/in-transit/reschedule",z={isModalContent:"1"},v=w(),q=r+v,A=1==m.stringDebug,x=h("#reschedule-calendar-page-container").hasClass("r2w");a.declarative("intransit-reschedule-open-modal",
"click",function(d){d.$event.preventDefault();var e=d.$currentTarget;e.find("a").data("ref");d=a.extend({},d.data);d.width=620>b.innerWidth?.75*b.innerWidth:600;d.name="rescheduleCalendarModal";d.dataStrategy="ajax";"#"===e.find("a").attr("href")?d.url=e.find("a").attr("data-modalurl"):d.url=e.find("a").attr("href");d.url=c.addQueryParameterToUrl(d.url,z);f.create(e,d).show()});p();k();a.on("a:popover:ajaxContentLoaded:rescheduleCalendarModal",k);a.declarative("submit-reschedule","click",function(c){c.$event.preventDefault();
c=e("#reschedule-submit-button");if(!1!==c.isEnabled()){c.disable();var f=l().tokenId;c=x?"R2W":"R2D";"undefined"===typeof f||null===f||"undefined"===f?(f=x?"request-reschedule-ajax-call-window-toggle-token-not-set":"request-reschedule-ajax-call-token-never-attempted-to-set",d.logError({feature:f,message:"The reschedule token was not set before submitting ("+c+")"}),d.incrementCount(f),b.location=q+"8"):a.post(y,{params:{rescheduleToken:f,stringDebug:A,csrfToken:b.csrfToken},dataType:"json",success:function(a){var c=
a.requestRescheduleDisplayResponse;if(a.success)d.incrementCount("request-reschedule-ajax-call-success"),b.location=q+"7";else{d.incrementCount("request-reschedule-ajax-call-failure");var c=(c=c.failureReason)||0,f="";c&&(f=", failureReason: "+c);d.logError({feature:"request-reschedule-ajax-call-failure-log",message:"Failed to request reschedule due to responseCode: "+a.responseCode+f});b.location=q+"8"}},error:function(a){d.incrementCount("request-reschedule-ajax-call-error");d.logError({feature:"request-reschedule-ajax-call-error-log",
message:("Error making a request to reschedule with",a)});b.location=q+"8"}})}})});"use strict";d.when("A","in-transit-url-utils","rescheduleDelivery","inTransitPackageCancellation","ready").execute("in-transit-loaded",function(a,d){var e=["PackageProgressTracker"];"desktop"===(a.state("page-state")||{}).deviceType&&(d=d.getQueryParameterFromUrl(b.location.search||b.location.href,"showModal"))&&-1<e.indexOf(b.uept.pageType||"")&&(e=d.replace(/[^0-9a-z\-\_]/gi,""),a=a.$("[data-action\x3d"+e+"]"),1===
a.length&&a.click())});"use strict";d.when("A","mash","page-load").execute(function(a,d){var e=document.getElementById("redirectToPickupPointCTA");e&&(e.onclick=function(){try{return d.navstack.begin().modalOpen(e.href).end(),!1}catch(a){console.log(a)}},b.addEventListener("popstate",function(){if(!b.location.href.includes("location-selector"))try{d.navstack.begin().modalClose().end()}catch(a){console.log(a)}}))});"use strict";d.when("A","a-modal","a-button","in-transit-url-utils","in-transit-csm-metrics-utils",
"ready").register("inTransitPackageCancellation",function(a,d,e,g,c){function u(){a.state.parse();l=a.state("page-state")||{};m=k();r=p+m;y=1==l.stringDebug;t()}function t(){n(".cancel-go-back").click(function(){b.history&&"function"===typeof b.history.back&&b.history.back()})}function k(){return"?"+n.param({orderId:l.orderId,shipmentId:l.shipmentId,packageIndex:l.packageIndex})+"\x26amzlMessageId\x3d"}var n=a.$,l=a.state("page-state")||{},p=-1!==b.location.host.indexOf("hp-shoppingportal")?"/portal/cstrac/progress-tracker":
"/progress-tracker/package",w=p+"/actions/in-transit/cancel",h={isModalContent:"1"},m=k(),r=p+m,y=1==l.stringDebug,z,v;a.declarative("intransit-cancel-open-modal","click",function(c){c.$event.preventDefault();var e=c.$currentTarget;e.find("a").data("ref");c=a.extend({},c.data);c.width=620>b.innerWidth?.75*b.innerWidth:600;c.name="cancelModal";c.dataStrategy="ajax";"#"===e.find("a").attr("href")?c.url=e.find("a").attr("data-modalurl"):c.url=e.find("a").attr("href");c.url=g.addQueryParameterToUrl(c.url,
h);d.create(e,c).show()});u();a.on("a:popover:ajaxContentLoaded:cancelModal",u);a.declarative("submit-intransit-cancel","click",function(d){d.$event.preventDefault();var e=document.getElementById("cancel-modal-data").dataset;d=e.deviceType;var f=e.isApp,e={orderId:e.orderId,shipmentId:e.shipmentId,packageId:e.packageIndex,stringDebug:y,deviceType:d,isApp:f,csrfToken:b.csrfToken};z="desktop"===d?"dt_":"mob_";v=f?"ap_":"b_";var g="\x26ref\x3dppx_pt2_"+z+v+"cancel_deli_submit";a.post(w,{params:e,dataType:"json",
success:function(a){var d=a.requestPackageCancellationDisplayResponse;if(a.success)c.incrementCount("request-intransit-cancel-ajax-call-success"),b.location=r+"15"+g;else{c.incrementCount("request-intransit-cancel-ajax-call-failure");var d=(d=d.displayableCancelMessage)||0,e="";d&&(e=", failureReason: "+d);c.logError({feature:"request-intransit-cancel-ajax-call-failure-log",message:"Failed to request package cancellation due to responseCode: "+a.responseCode+e});b.location=r+"6"+g}},error:function(a){c.incrementCount("request-intransit-cancel-ajax-call-error");
c.logError({feature:"request-intransit-cancel-ajax-call-failure-log",message:("Error making a request to package cancellation with",a)});b.location=r+"6"+g}})})})});